{% extends 'base.html' %}

{% block content %}
<div class="playlist-explorer">
  <!-- Header with Title and Login Button -->
  <header class="header">
    <div class="header-content">
      <h1>Main Page / Playlist Explorer</h1>
      <div class="auth-buttons">
        {% if user.is_authenticated %}
          <span class="user-greeting">{{ user.username }}</span>
          <a href="{% url 'logout' %}" class="btn btn-secondary">Logout</a>
        {% else %}
          <a href="{% url 'login' %}" class="btn btn-primary">Login</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <section class="playlists-section">
      <h2>Top Playlists - Likes</h2>
      
      <div class="playlists-grid">
        {% for playlist in playlists %}
          <div class="playlist-card">
            <!-- Playlist Cover -->
            <div class="playlist-cover">
              {% if playlist.cover_image %}
                <img src="{{ playlist.cover_image }}" alt="{{ playlist.name }}">
              {% else %}
                <div class="placeholder-cover">Cover Art</div>
              {% endif %}
            </div>
            
            <!-- Playlist Info -->
            <div class="playlist-info">
              <div class="playlist-header">
                <div class="info-icon">👤</div>
                <a href="{% url 'profile' playlist.creator.id %}" class="creator-profile">
                  Profile
                </a>
              </div>
              
              <div class="playlist-details">
                <p class="duration">{{ playlist.total_duration }}</p>
                <p class="likes">{{ playlist.likes }} 👍</p>
              </div>
              
              <!-- Spotify Embed -->
              <div class="spotify-embed">
                {% if playlist.spotify_uri %}
                  <iframe 
                    src="https://open.spotify.com/embed/playlist/{{ playlist.spotify_id }}" 
                    width="100%" 
                    height="380" 
                    frameborder="0" 
                    allowfullscreen="" 
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                    loading="lazy">
                  </iframe>
                {% else %}
                  <p class="no-embed">Spotify embed not available</p>
                {% endif %}
              </div>
              
              <!-- Sample Songs -->
              <div class="sample-songs">
                {% for song in playlist.sample_songs.all|slice:":3" %}
                  <p class="song">♪ {{ song.name }}</p>
                {% endfor %}
              </div>
            </div>
          </div>
        {% empty %}
          <div class="no-playlists">
            <p>No playlists found. Create one to get started!</p>
          </div>
        {% endfor %}
      </div>
    </section>
  </main>

  <!-- Search/Chat Bar at Bottom -->
  <footer class="search-footer">
    <form method="GET" action="{% url 'search' %}" class="search-form">
      <div class="search-container">
        <input 
          type="text" 
          name="q" 
          placeholder="Chat to find/make playlist" 
          class="search-input"
          value="{{ request.GET.q }}"
        >
        <button type="submit" class="search-btn">🔍</button>
      </div>
    </form>
  </footer>
</div>
{% endblock %}