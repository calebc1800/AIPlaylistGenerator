{% extends 'home/base.html' %}

{% block content %}
<div class="playlist-explorer">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1>Main Page / Playlist Explorer</h1>
      <div class="auth-buttons">
        {% if user.is_authenticated %}
          <span class="user-greeting">{{ user.username }}</span>
          <a href="{% url 'logout' %}" class="btn btn-secondary">Logout</a>
        {% else %}
          <a href="{% url 'login' %}" class="btn btn-primary">Login</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <section class="playlists-section">
      <h2>Top Playlists - Likes</h2>

      <div class="playlists-grid">
        {% for playlist in playlists %}
          <div class="playlist-card">
            <!-- Top: Image + Info -->
            <div class="playlist-top">
              <div class="playlist-cover">
                {% if playlist.cover_image %}
                  <img src="{{ playlist.cover_image }}" alt="{{ playlist.name }}">
                {% else %}
                  <div class="placeholder-cover">Cover Art</div>
                {% endif %}
              </div>

              <div class="playlist-info">
                <div class="playlist-header">
                  <div class="info-icon">👤</div>
                  <span class="creator-profile">{{ playlist.creator.username }}</span>
                </div>

                <div class="playlist-details">
                  {% if playlist.total_duration %}
                    <p class="duration">{{ playlist.total_duration }}</p>
                  {% endif %}
                  <p class="likes">{{ playlist.likes }} 👍</p>
                </div>

                <div class="sample-songs">
                  {% for song in playlist.sample_songs.all|slice:":3" %}
                    <p class="song">♪ {{ song.name }}</p>
                  {% empty %}
                    <p class="song">No songs available</p>
                  {% endfor %}
                </div>
              </div>
            </div>

            <!-- Spotify Embed below -->
            <div class="spotify-embed">
              {% if playlist.spotify_id %}
                <iframe
                  src="https://open.spotify.com/embed/playlist/{{ playlist.spotify_id }}"
                  allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                  loading="lazy">
                </iframe>
              {% else %}
                <p class="no-embed">Spotify embed not available</p>
              {% endif %}
            </div>
          </div>
        {% empty %}
          <div class="no-playlists">
            <p>No playlists found. Create one to get started!</p>
          </div>
        {% endfor %}
      </div>
    </section>
  </main>

  <!-- Footer Search -->
  <footer class="search-footer">
    <form method="GET" action="{% url 'search' %}" class="search-form">
      <div class="search-container">
        <input
          type="text"
          name="q"
          placeholder="Chat to find/make playlist"
          class="search-input"
          value="{{ request.GET.q }}"
        >
        <button type="submit" class="search-btn">🔍</button>
      </div>
    </form>
  </footer>
</div>
{% endblock %}