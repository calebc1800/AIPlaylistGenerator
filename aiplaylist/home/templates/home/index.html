{% extends 'home/base.html' %}

<style>
      .spotify-button {
          display: inline-flex;
          align-items: center;
          gap: 12px;
          background: #1DB954;
          color: white;
          padding: 15px 35px;
          border-radius: 50px;
          text-decoration: none;
          font-weight: 600;
          font-size: 1.1rem;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(29, 185, 84, 0.3);
      }

      .spotify-button:hover {
          background: #1ed760;
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(29, 185, 84, 0.4);
      }

      .spotify-button:active {
          transform: translateY(0);
      }

      .spotify-icon {
          width: 30px;
          height: 30px;  
</style>
  
{% block content %}
<div class="playlist-explorer">
  <header class="header">
    <div class="header-content">
      <h1>Main Page / Playlist Explorer</h1>
      <div class="auth-buttons">
        {% if user.is_authenticated %}
          <span class="user-greeting">{{ user.username }}</span>
          <a href="{% url 'logout' %}" class="btn btn-secondary">Logout</a>
        {% else %}
          <h2>Get Started</h2>
          <p>Connect your Spotify account to start generating AI-powered playlists</p>
          <a href="{% url 'spotify_auth:login' %}" class="spotify-button">
            Login with Spotify
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Spotify_icon.svg" alt="Spotify Logo" class="spotify-icon" >
        </a>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="main-content">
    <section class="playlists-section">
      <h2>Top Playlists - Likes</h2>

      <div class="playlists-grid">
        {% for playlist in playlists %}
          <div class="playlist-card">
            <!-- Top: Image + Info -->
            <div class="playlist-top">
              <div class="playlist-cover">
                {% if playlist.cover_image %}
                  <img src="{{ playlist.cover_image }}" alt="{{ playlist.name }}">
                {% else %}
                  <div class="placeholder-cover">Cover Art</div>
                {% endif %}
              </div>

              <div class="playlist-info">
                <div class="playlist-header">
                  <div class="info-icon">üë§</div>
                  <span class="creator-profile">{{ playlist.creator.username }}</span>
                </div>

                <div class="playlist-details">
                  {% if playlist.total_duration %}
                    <p class="duration">{{ playlist.total_duration }}</p>
                  {% endif %}
                  <p class="likes">{{ playlist.likes }} üëç</p>
                </div>

                <div class="sample-songs">
                  {% for song in playlist.sample_songs.all|slice:":3" %}
                    <p class="song">‚ô™ {{ song.name }}</p>
                  {% empty %}
                    <p class="song">No songs available</p>
                  {% endfor %}
                </div>
              </div>
            </div>

            <!-- Spotify Embed below -->
            <div class="spotify-embed">
              {% if playlist.spotify_id %}
                <iframe
                  src="https://open.spotify.com/embed/playlist/{{ playlist.spotify_id }}"
                  allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                  loading="lazy">
                </iframe>
              {% else %}
                <p class="no-embed">Spotify embed not available</p>
              {% endif %}
            </div>
          </div>
        {% empty %}
          <div class="no-playlists">
            <p>No playlists found. Create one to get started!</p>
          </div>
        {% endfor %}
      </div>
    </section>
  </main>

  <footer class="search-footer">
    <form method="GET" action="{% url 'search' %}" class="search-form">
      <div class="search-container">
        <input
          type="text"
          name="q"
          placeholder="Chat to find/make playlist"
          class="search-input"
          value="{{ request.GET.q }}"
        >
        <button type="submit" class="search-btn">üîç</button>
      </div>
    </form>
  </footer>
</div>
{% endblock %}
